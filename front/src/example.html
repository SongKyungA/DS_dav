<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D3 Expiry Simulation</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
    <div id="fridge"></div>

    <script>
        // 데이터셋 - 예시 데이터
        const items = [
            // 현재 시간으로부터 10초 뒤 유통 기한을 설정
            { name: 'Milk', imageUrl: 'https://storage.googleapis.com/dav-project-b0edb.appspot.com/apple-fruit.png', expiryDate: new Date(new Date().getTime() + 10000) },
            // 다른 아이템들...
        ];
        // URL test
        // 1) https://firebasestorage.googleapis.com/v0/b/dav-project-b0edb.appspot.com/o/apple-fruit.png?alt=media&token=9119fe8c-234c-4563-bb70-cdac0c48ef61
        // 2) https://storage.googleapis.com/dav-project-b0edb.appspot.com/apple-fruit.png    

        // D3.js를 사용하여 아이템 이미지와 유통 기한 텍스트 추가
        const fridge = d3.select('#fridge').selectAll('div')
            .data(items)
            .enter()
            .append('div')
            .style('position', 'relative');

        fridge.append('img')
            .attr('src', d => d.imageUrl)
            .attr('alt', d => d.name)
            .style('opacity', 1) // 초기 투명도 설정
            .style('transition', 'opacity 1s linear') // 투명도 변화 애니메이션
            .style('position', 'absolute');

        fridge.append('span')
            .text(d => `Expiry: ${d.expiryDate.toISOString().substring(0, 10)}`)
            .style('z-index', 10)
            .style('position', 'absolute')
            .style('color', 'white')
            .style('padding', '5px')
            .style('bottom', '5px');

        // 유통기한에 따른 투명도 계산 함수
        function calculateOpacity(expiryDate) {
            const diffTime = expiryDate - new Date();
            const diffSeconds = diffTime / 1000;

            if (diffSeconds <= 0) {
                return 0.2; // 유통 기한이 지났을 때 투명도 20% (예시)
            }

            // 시간이 지남에 따라 투명도가 0에서 1까지 선형적으로 변함
            return Math.max(0.2, 1 - diffSeconds / 10); // 10초 동안 투명도가 1에서 0.2까지 변함
        }

        // 시뮬레이션 업데이트 함수
        function updateSimulation() {
            fridge.data(items)
                .select('img')
                .style('opacity', d => calculateOpacity(d.expiryDate));
        }

        // 1초마다 색상 업데이트
        setInterval(updateSimulation, 1000);
    </script>
</body>
</html>
